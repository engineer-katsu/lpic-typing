<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LPIC Penguin Rescue - No Duplicates</title>
    <style>
        :root {
            --sky-blue: #87ceeb;
            --ice-white: #f0f8ff;
            --term-green: #00ff41;
            --error-red: #ff4757;
            --ocean-blue: #1e3799;
        }

        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background-color: var(--sky-blue); }

        /* --- „É¨„Ç§„Ç¢„Ç¶„Éà --- */
        #world { display: flex; flex-direction: column; height: 100vh; }
        #sky { flex: 3; position: relative; background: linear-gradient(to bottom, #2980b9, #6dd5fa); }
        #typing-area { flex: 4; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; }
        #ground { flex: 3; background: linear-gradient(to bottom, #fff 0%, var(--ice-white) 100%); position: relative; border-top: 5px solid #dff9fb; }

        /* --- Ë£ÖÈ£æ --- */
        .cloud { position: absolute; background: #fff; width: 120px; height: 45px; border-radius: 50px; opacity: 0.9; animation: moveCloud linear infinite; }
        .cloud::after { content: ''; position: absolute; top: -20px; left: 20px; width: 50px; height: 50px; background: #fff; border-radius: 50%; }
        .cloud::before { content: ''; position: absolute; top: -25px; left: 50px; width: 60px; height: 60px; background: #fff; border-radius: 50%; }
        @keyframes moveCloud { from { transform: translateX(110vw); } to { transform: translateX(-20vw); } }

        /* --- „Çø„Ç§„Éî„É≥„Ç∞Ë°®Á§∫ --- */
        #cmd-display { background: rgba(0, 0, 0, 0.75); padding: 40px; border-radius: 25px; border: 4px solid #fff; box-shadow: 0 15px 40px rgba(0,0,0,0.6); text-align: center; min-width: 600px; }
        #target-desc { color: #bdc3c7; font-size: 1.4rem; margin-bottom: 15px; }
        #target-text { font-family: 'Consolas', monospace; font-size: 3rem; color: #fff; letter-spacing: 3px; }
        .correct { color: var(--term-green); text-shadow: 0 0 10px var(--term-green); }
        .current { border-bottom: 4px solid #fff; }

        /* --- „Éö„É≥„ÇÆ„É≥„Å®Á©¥ --- */
        #penguin { position: absolute; bottom: 50px; left: 10%; font-size: 6rem; z-index: 20; transition: transform 0.2s; }
        #pit { position: absolute; right: 0; bottom: 0; width: 15%; height: 100%; background: var(--ocean-blue); clip-path: polygon(25% 0, 100% 0, 100% 100%, 0% 100%); }
        
        /* --- Ë®≠ÂÆö„Éª„É™„Ç∂„É´„Éà --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; color: white; }
        .diff-select { margin: 20px; display: flex; gap: 20px; }
        .diff-btn { padding: 10px 20px; cursor: pointer; border: 2px solid #fff; background: transparent; color: #fff; font-size: 1.2rem; border-radius: 10px; }
        .diff-btn.active { background: var(--term-green); color: #000; border-color: var(--term-green); }
        
        button#main-start { padding: 20px 80px; font-size: 2.5rem; background: var(--term-green); border: none; border-radius: 60px; cursor: pointer; margin-top: 20px; }
        .miss-flash { animation: flash 0.1s; }
        @keyframes flash { from { background-color: var(--error-red); } to { background-color: transparent; } }
    </style>
</head>
<body onclick="initAudio()">

<div id="world">
    <div id="sky">
        <div class="cloud" style="top: 15%; animation-duration: 30s;"></div>
        <div class="cloud" style="top: 40%; animation-duration: 50s; width: 180px;"></div>
    </div>
    
    <div id="typing-area">
        <div id="cmd-display">
            <div id="target-desc">Èõ£ÊòìÂ∫¶„ÇíÈÅ∏„Çì„Åß„Çπ„Çø„Éº„Éà</div>
            <div id="target-text">READY?</div>
        </div>
    </div>

    <div id="ground">
        <div id="penguin">üêß</div>
        <div id="pit"></div>
    </div>
</div>

<div id="start-screen" class="overlay">
    <h1 style="font-size: 4rem; margin-bottom: 10px;">üêß LPIC RESCUE</h1>
    <div class="diff-select">
        <button class="diff-btn" id="btn-3000" onclick="setDifficulty(2.5, 'btn-3000')">3000ÂÜÜ„Ç≥„Éº„Çπ</button>
        <button class="diff-btn active" id="btn-5000" onclick="setDifficulty(4.0, 'btn-5000')">5000ÂÜÜ„Ç≥„Éº„Çπ</button>
        <button class="diff-btn" id="btn-10000" onclick="setDifficulty(6.5, 'btn-10000')">10000ÂÜÜ„Ç≥„Éº„Çπ</button>
    </div>
    <button id="main-start" onclick="startGame()">START (Enter)</button>
</div>

<div id="result-screen" class="overlay" style="display: none;">
    <h2 style="font-size: 4rem;">RESULT</h2>
    <div id="stats" style="font-size: 2rem; margin: 40px; text-align: center; line-height: 1.6;"></div>
    <button onclick="location.reload()">RETRY</button>
</div>

<script>
    const baseQuestions = [
        { cmd: "ls -la", desc: "Èö†„Åó„Éï„Ç°„Ç§„É´„ÇíÂê´„ÇÄÂÖ®„Éï„Ç°„Ç§„É´„ÅÆË©≥Á¥∞„ÇíË°®Á§∫" },
        { cmd: "ls -ltr", desc: "Êõ¥Êñ∞Êó•ÊôÇ„ÅåÂè§„ÅÑÈ†Ü„Å´Ë°®Á§∫ÔºàÂÆüÂãô„Åß„É≠„Ç∞Á¢∫Ë™ç„Å´Â§öÁî®Ôºâ" },
        { cmd: "cp -rp src/ dest/", desc: "Ê®©Èôê„ÇÑÂ±ûÊÄß„Çí‰øùÊåÅ„Åó„Åü„Åæ„Åæ„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíÂÜçÂ∏∞ÁöÑ„Å´„Ç≥„Éî„Éº" },
        { cmd: "rm -rf /tmp/olddata", desc: "„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇíË≠¶Âëä„Å™„Åó„ÅßÂº∑Âà∂ÂâäÈô§ÔºàÂèñÊâ±Ê≥®ÊÑèÔºâ" },
        { cmd: "mkdir -p /a/b/c", desc: "‰∏≠Èñì„Éá„Ç£„É¨„ÇØ„Éà„É™„ÇÇÂê´„ÇÅ„Å¶‰∏ÄÊ∞ó„Å´‰ΩúÊàê" },
        { cmd: "ln -s target link", desc: "„Ç∑„É≥„Éú„É™„ÉÉ„ÇØ„É™„É≥„ÇØÔºà„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„ÉàÔºâ„Çí‰ΩúÊàê" },
        { cmd: "find /var/log -name '*.log'", desc: "ÊåáÂÆö„Éá„Ç£„É¨„ÇØ„Éà„É™„Åã„Çâ„É≠„Ç∞„Éï„Ç°„Ç§„É´„ÇíÊ§úÁ¥¢" },
        { cmd: "chown root:root file", desc: "ÊâÄÊúâËÄÖ„Å®„Ç∞„É´„Éº„Éó„Çí‰∏°Êñπroot„Å´Â§âÊõ¥" },
        { cmd: "chmod 644 file", desc: "ÊâÄÊúâËÄÖ„Å´Ë™≠Êõ∏Ê®©Èôê„ÄÅ„Åù„ÅÆ‰ªñ„Å´Ë™≠ËæºÊ®©Èôê„Çí‰ªò‰∏é" },
        { cmd: "chmod 755 script.sh", desc: "„Çπ„ÇØ„É™„Éó„Éà„Å´ÂÆüË°åÊ®©Èôê„Çí‰ªò‰∏é" },
        { cmd: "umask 022", desc: "Êñ∞Ë¶è„Éï„Ç°„Ç§„É´„ÅÆ„Éá„Éï„Ç©„É´„ÉàÊ®©Èôê„ÇíË®≠ÂÆö" },
        { cmd: "cat /etc/passwd", desc: "„Éï„Ç°„Ç§„É´„ÅÆ‰∏≠Ë∫´„ÇíÂÖ®Ë°®Á§∫" },
        { cmd: "less /var/log/messages", desc: "Èï∑„ÅÑ„Éï„Ç°„Ç§„É´„Çí1ÁîªÈù¢„Åö„Å§Ë°®Á§∫ÔºàÈñ≤Ë¶ß„Å´ÊúÄÈÅ©Ôºâ" },
        { cmd: "head -n 10 file", desc: "„Éï„Ç°„Ç§„É´„ÅÆÂÖàÈ†≠10Ë°å„ÇíË°®Á§∫" },
        { cmd: "tail -f /var/log/syslog", desc: "„É≠„Ç∞„ÅÆÊõ¥Êñ∞„Çí„É™„Ç¢„É´„Çø„Ç§„É†„ÅßÁõ£Ë¶ñ" },
        { cmd: "grep -i 'error' file", desc: "Â§ßÊñáÂ≠óÂ∞èÊñáÂ≠ó„ÇíÂå∫Âà•„Åõ„ÅöÊ§úÁ¥¢" },
        { cmd: "grep -v '^#' file", desc: "„Ç≥„É°„É≥„ÉàË°åÔºà#ÈñãÂßãÔºâ„ÇíÈô§Â§ñ„Åó„Å¶Ë°®Á§∫" },
        { cmd: "sed -i 's/old/new/g' file", desc: "„Éï„Ç°„Ç§„É´ÂÜÖ„ÅÆÊñáÂ≠óÂàó„ÇíÁõ¥Êé•ÁΩÆÊèõ" },
        { cmd: "awk '{print $1}' file", desc: "ÂêÑË°å„ÅÆ1Áï™ÁõÆ„ÅÆÈ†ÖÁõÆ„Å†„Åë„ÇíÊäΩÂá∫" },
        { cmd: "sort -u file", desc: "ÈáçË§á„ÇíÊéíÈô§„Åó„Å¶‰∏¶„ÅπÊõø„Åà" },
        { cmd: "wc -l file", desc: "„Éï„Ç°„Ç§„É´„ÅÆË°åÊï∞„Çí„Ç´„Ç¶„É≥„Éà" },
        { cmd: "ps aux", desc: "ÂÆüË°å‰∏≠„ÅÆÂÖ®„Éó„É≠„Çª„Çπ„ÇíË©≥Á¥∞Ë°®Á§∫" },
        { cmd: "top", desc: "„É™„ÇΩ„Éº„Çπ‰ΩøÁî®Áéá„Çí„É™„Ç¢„É´„Çø„Ç§„É†Ë°®Á§∫ÔºàQ„ÅßÁµÇ‰∫ÜÔºâ" },
        { cmd: "kill -9 1234", desc: "„Éó„É≠„Çª„ÇπID 1234„ÇíÂº∑Âà∂ÁµÇ‰∫Ü" },
        { cmd: "jobs", desc: "„Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Ç∏„Éß„Éñ„ÅÆ‰∏ÄË¶ß„ÇíË°®Á§∫" },
        { cmd: "df -h", desc: "„Éá„Ç£„Çπ„ÇØ„ÅÆÁ©∫„ÅçÂÆπÈáè„Çí‰∫∫Èñì„ÅåË™≠„Åø„ÇÑ„Åô„ÅÑÂΩ¢Âºè„ÅßË°®Á§∫" },
        { cmd: "du -sh *", desc: "ÁèæÂú®„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™ÂÜÖ„ÅÆÂÆπÈáèÂêàË®à„ÇíË°®Á§∫" },
        { cmd: "fdisk -l", desc: "„Éá„Ç£„Çπ„ÇØ„Éë„Éº„ÉÜ„Ç£„Ç∑„Éß„É≥ÊßãÊàê„ÇíÁ¢∫Ë™ç" },
        { cmd: "mount", desc: "„Éû„Ç¶„É≥„Éà„Åï„Çå„Å¶„ÅÑ„Çã„Éá„Éê„Ç§„Çπ„ÇíË°®Á§∫" },
        { cmd: "echo $PATH", desc: "„Ç≥„Éû„É≥„Éâ„ÅÆÊ§úÁ¥¢„Éë„Çπ„ÇíË°®Á§∫" },
        { cmd: "export VAR=val", desc: "Áí∞Â¢ÉÂ§âÊï∞„ÇíË®≠ÂÆö" },
        { cmd: "alias ll='ls -l'", desc: "„Ç≥„Éû„É≥„Éâ„ÅÆÂà•Âêç„ÇíË®≠ÂÆö" },
        { cmd: "ip addr show", desc: "IP„Ç¢„Éâ„É¨„Çπ„Å®„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ„ÇíË°®Á§∫" },
        { cmd: "ip route show", desc: "„É´„Éº„ÉÜ„Ç£„É≥„Ç∞„ÉÜ„Éº„Éñ„É´„ÇíË°®Á§∫" },
        { cmd: "ping -c 4 8.8.8.8", desc: "4Âõû„Å†„ÅëÁñéÈÄöÁ¢∫Ë™ç„ÇíÈÄÅ„Çã" },
        { cmd: "netstat -tulnp", desc: "ÂæÖÊ©ü‰∏≠„ÅÆ„Éù„Éº„Éà„Å®„Éó„É≠„Çª„Çπ„ÇíÁ¢∫Ë™ç" },
        { cmd: "ss -ant", desc: "TCPÊé•Á∂ö„ÅÆÁä∂ÊÖã„ÇíË°®Á§∫" },
        { cmd: "dig google.com", desc: "DNS„ÅÆÊ≠£Âºï„ÅçÊÉÖÂ†±„ÇíÁ¢∫Ë™ç" },
        { cmd: "ssh -p 22 user@host", desc: "„Éù„Éº„Éà„ÇíÊåáÂÆö„Åó„Å¶„É™„É¢„Éº„ÉàÊé•Á∂ö" },
        { cmd: "systemctl start httpd", desc: "Web„Çµ„Éº„Éê„Éº„ÇíËµ∑Âãï" },
        { cmd: "systemctl stop firewalld", desc: "„Éï„Ç°„Ç§„Ç¢„Ç¶„Ç©„Éº„É´„ÇíÂÅúÊ≠¢" },
        { cmd: "systemctl enable sshd", desc: "SSH„ÅÆËá™ÂãïËµ∑Âãï„ÇíÊúâÂäπÂåñ" },
        { cmd: "systemctl status crond", desc: "ÂÆöÊúüÂÆüË°å„Çµ„Éº„Éì„Çπ„ÅÆÁ®ºÂÉçÁä∂ÊÖã„ÇíÁ¢∫Ë™ç" },
        { cmd: "journalctl -xe", desc: "„Ç∑„Çπ„ÉÜ„É†„É≠„Ç∞„ÅÆÊú´Â∞æ„Åã„Çâ„Ç®„É©„ÉºË©≥Á¥∞„ÇíÁ¢∫Ë™ç" },
        { cmd: "crontab -e", desc: "ÂÆöÊúüÂÆüË°å„Çø„Çπ„ÇØ„ÅÆÁ∑®ÈõÜ" },
        { cmd: "useradd -m -s /bin/bash user", desc: "„É≠„Ç∞„Ç§„É≥„Ç∑„Çß„É´„ÇíÊåáÂÆö„Åó„Å¶„É¶„Éº„Ç∂„ÉºËøΩÂä†" },
        { cmd: "passwd username", desc: "ÊåáÂÆö„É¶„Éº„Ç∂„Éº„ÅÆ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂ§âÊõ¥" },
        { cmd: "groupadd team-a", desc: "Êñ∞„Åó„ÅÑ„Ç∞„É´„Éº„Éó„Çí‰ΩúÊàê" },
        { cmd: "id root", desc: "„É¶„Éº„Ç∂„Éº„ÅÆUID/GID„ÇíÁ¢∫Ë™ç" },
        { cmd: "yum install nginx", desc: "RedHatÁ≥ª„Åß„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´" },
        { cmd: "apt update && apt upgrade", desc: "DebianÁ≥ª„ÅßÂÖ®„Éë„ÉÉ„Ç±„Éº„Ç∏„ÇíÊõ¥Êñ∞" },
        { cmd: "rpm -qa", desc: "„Ç§„É≥„Çπ„Éà„Éº„É´Ê∏à„Åø„ÅÆRPM„Éë„ÉÉ„Ç±„Éº„Ç∏„ÇíÂÖ®Ë°®Á§∫" },
        { cmd: "dpkg -l", desc: "„Ç§„É≥„Çπ„Éà„Éº„É´Ê∏à„Åø„ÅÆDebian„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí‰∏ÄË¶ßË°®Á§∫" },
        { cmd: "/etc/hostname", desc: "„Éõ„Çπ„ÉàÂêç„ÇíË®≠ÂÆö„Åô„Çã„Éï„Ç°„Ç§„É´" },
        { cmd: "/etc/hosts", desc: "IP„Ç¢„Éâ„É¨„Çπ„Å®„Éõ„Çπ„ÉàÂêç„ÅÆÂØæÂøúË°®" },
        { cmd: "/etc/resolv.conf", desc: "DNS„Çµ„Éº„Éê„Éº„ÅÆË®≠ÂÆö„Éï„Ç°„Ç§„É´" },
        { cmd: "/etc/fstab", desc: "„Éï„Ç°„Ç§„É´„Ç∑„Çπ„ÉÜ„É†„ÅÆËá™Âãï„Éû„Ç¶„É≥„ÉàË®≠ÂÆö" },
        { cmd: "/etc/shadow", desc: "ÊöóÂè∑Âåñ„Åï„Çå„Åü„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰øùÂ≠ò„Åï„Çå„Çã„Éï„Ç°„Ç§„É´" },
        { cmd: "/etc/sudoers", desc: "sudoÊ®©Èôê„ÇíÁÆ°ÁêÜ„Åô„Çã„Éï„Ç°„Ç§„É´Ôºàvisudo„ÅßÁ∑®ÈõÜÔºâ" }
    ];

    let gameQuestions = [];
    let qIndex = 0;
    let currentQ, typedIndex, score, timeLeft, gameActive;
    let penguinPos = 10;
    let audioCtx = null;
    let charsPerSecond = 4.0;

    function setDifficulty(cps, btnId) {
        charsPerSecond = cps;
        document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(btnId).classList.add('active');
        initAudio(); 
    }

    function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playSound(freq, type, duration) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    // --- „Éï„Ç£„ÉÉ„Ç∑„É£„Éº„Éª„Ç§„Çß„Éº„ÉÑ„ÅÆ„Ç∑„É£„ÉÉ„Éï„É´ ---
    function shuffleQuestions(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        
        // ÂïèÈ°å„Çí„Ç∑„É£„ÉÉ„Éï„É´„Åó„Å¶„É™„Çª„ÉÉ„Éà
        gameQuestions = shuffleQuestions([...baseQuestions]);
        qIndex = 0;
        
        gameActive = true;
        score = 0;
        timeLeft = 60;
        nextQuestion();
        gameLoop();
        
        const timerId = setInterval(() => {
            if(gameActive) {
                timeLeft--;
                if(timeLeft <= 0) {
                    clearInterval(timerId);
                    endGame("TIME UP!");
                }
            } else {
                clearInterval(timerId);
            }
        }, 1000);
    }

    function nextQuestion() {
        if (qIndex >= gameQuestions.length) {
            gameActive = false;
            endGame("ALL CLEAR!");
            return;
        }
        currentQ = gameQuestions[qIndex];
        qIndex++;
        typedIndex = 0;
        penguinPos = 10;
        updateDisplay();
    }

    function updateDisplay() {
        let html = "";
        for (let i = 0; i < currentQ.cmd.length; i++) {
            if (i < typedIndex) html += `<span class="correct">${currentQ.cmd[i]}</span>`;
            else if (i === typedIndex) html += `<span class="current">${currentQ.cmd[i]}</span>`;
            else html += `<span>${currentQ.cmd[i]}</span>`;
        }
        document.getElementById('target-text').innerHTML = html;
        document.getElementById('target-desc').innerText = currentQ.desc;
    }

    function gameLoop() {
        if (!gameActive) return;

        const totalDistance = 75; 
        const timeAllowed = currentQ.cmd.length / charsPerSecond;
        const fps = 60;
        const speedPerFrame = totalDistance / (timeAllowed * fps);

        penguinPos += speedPerFrame;
        document.getElementById('penguin').style.left = penguinPos + "%";

        if (penguinPos > 85) {
            playSound(150, 'sawtooth', 0.3);
            score = Math.max(0, score - 100);
            nextQuestion(); // ËêΩ„Å°„Åü„ÇâÊ¨°„ÅÆÂïèÈ°åÔºàÈáçË§á„Å™„Åó„Å™„ÅÆ„ÅßÊàª„Çâ„Å™„ÅÑÔºâ
        }

        requestAnimationFrame(gameLoop);
    }

    window.addEventListener('keydown', (e) => {
        if (!gameActive) {
            if (e.key === 'Enter') startGame();
            return;
        }
        if (e.key.length > 1) return;
